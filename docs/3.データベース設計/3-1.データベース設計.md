# データベース設計

## 基本指針

DB は Firestore を利用する。コレクションを 3 つに分割して、それぞれ

- UID と 1 対 1 対応のデータを保存する users コレクション
- スカウトの情報を保存する scouts コレクション
- グループ利用者のそれぞれのデータを保管する groups コレクション
  とする。

## users コレクションについて

users コレクションの中では、すべてのデータはキーが UID と一致し、またその UID が auth.uid と一致する場合にのみ
　すべての編集が可能となる。ただし、メールアドレスを保存する mail の項目の変更については、auth.emailVerified
　が true の場合のみ編集が可能となる。

クライアントサイドで auth から取れる情報と users から取れる情報に差異があるときは、emailVerified が false なら
　メール認証が未完了としてユーザーにメールボックスを見るよう促す。true ならログイン処理の中で db 側を書き換える。

## scouts コレクションについて

scouts コレクションでは、スカウト単位のデータ（進級状況など）を保存する。

authed_user 配列の中のオブジェクトの mail キーが auth から取れる情報と一致し、メールアドレスが認証済みの
　場合に限り、そのオブジェクトの role に見合った操作が許容される。ただし、groups で定める方とは異なり VIEW と
　 EDIT の二種類しかない。これはグループの管理ができる/できないの違いがここにおいては不要だからである。

また、belongs に登録された ID と、user が所属する団体の UID が一致し、groups/{id}/admins/{各 uid}が存在する場合に限り、
　その記録の role に相当する操作が可能になる。

## groups コレクションについて

groups コレクションでは各グループの情報（団体名：吹田 9 団、茨城 n 団など）を保存する。

各グループの admins/{各 uid}の role が ADMIN だった場合にのみ、groups の情報の編集のみが可能となる。

admins 以下については、uid が一致する場合に閲覧のみ可能、role が ADMIN なら新規作成・列挙と role が admin 以外の対象
　の編集・削除が可能である。
