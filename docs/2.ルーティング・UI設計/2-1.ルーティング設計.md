# ルーティング設計

## 実装済みルーティング

### / ランディングページ（静的生成）

- **実装状況**: ✅ 完成
- **機能**:
  - アプリの紹介とマーケティング
  - 認証ページへの導線
  - 静的 HTML として配信（SEO 最適化）
- **生成場所**: `staticBuilder/landing/`
- **配信**: Firebase Hosting で高速配信

### /auth/ 認証ページ

- **実装状況**: ✅ 完成
- **機能**:
  - AuthContext でログイン情報供給
  - 既にログインしていたら `/app` にリダイレクト
  - 背景画像とブラーカードによる統一 UI
- **共通コンポーネント**:
  - `auth.tsx`: ルーティングとレイアウト
  - `formGroup.tsx`: フォーム部品
  - `moveCard.tsx`: 画面間遷移リンク

#### /auth/login ログインページ

- **実装状況**: ✅ 完成
- **機能**: Firebase Authentication でログイン
- **コンポーネント**: `Signin/signin.tsx`

#### /auth/register 新規登録

- **実装状況**: ✅ 完成
- **機能**:
  - アカウント作成
  - メールアドレス認証メール送信
  - 利用規約同意チェック
- **コンポーネント**: `Register/register.tsx`

#### /auth/reset パスワードリセット

- **実装状況**: ✅ 完成
- **機能**: パスワードリセットメール送信
- **コンポーネント**: `Reset/reset.tsx`

#### /auth/verify メール認証

- **実装状況**: ✅ 完成
- **機能**: メールアドレス認証確認画面
- **コンポーネント**: `VerifyEmail/verifyEmail.tsx`

### /app/ メインアプリケーション

- **実装状況**: 🚧 基本機能実装済み
- **認証**: ログアウト状態なら `/auth/login` にリダイレクト
- **現在の機能**: ヘッダーナビゲーション、ロール別ホーム、スカウト管理

#### /app/ ホーム（ダッシュボード）

- **実装状況**: ✅ 実装済み
- **機能**:
  - リーダー向けホーム（`leaderHome.tsx`）: 管理機能へのリンク
  - 見学者向けホーム（`visitorHome.tsx`）: 閲覧機能のみ
  - ロール別の表示切り替え

#### /app/scouts スカウト検索・管理

- **実装状況**: 🚧 基本機能実装済み
- **機能**:
  - スカウト情報の検索・閲覧
  - 検索クエリのキャッシュ機能
  - 検索結果の表示とフィルタリング
- **コンポーネント**: `scouts/scouts.tsx`

#### /app/scouts/new 新規スカウト登録

- **実装状況**: ✅ 実装済み
- **機能**: 新しいスカウトの登録ウィザード
- **コンポーネント**: `scoutDetail/newScoutWizard.tsx`

#### /app/scouts/:id スカウト詳細

- **実装状況**: 🚧 基本機能実装済み
- **機能**:
  - スカウト詳細情報の表示・編集
  - 表示モード（`viewer.tsx`）と編集モード（`editor.tsx`）
  - プロフィール、所属部門、技能章、イベント管理
- **コンポーネント**: `scoutDetail/`

#### /app/group グループ管理

- **実装状況**: ❌ 未実装
- **予定機能**: 団体所属者の情報表示・管理

#### /app/setting 設定画面

- **実装状況**: ❌ 未実装
- **予定機能**: ユーザー設定、アカウント管理

### /sysmanager/ システム管理

- **実装状況**: ✅ 基本実装
- **機能**: 管理者専用機能（特定ユーザーのみアクセス可能）
- **アクセス制御**: `work@kihamda.net` のみアクセス可能

## URL 設計パターン

```
/ (ランディング - 静的生成)
├── /auth/*          # 認証関連
│   ├── /auth/login
│   ├── /auth/register
│   ├── /auth/reset
│   └── /auth/verify
├── /app/*           # メインアプリ
│   ├── /app/        # ダッシュボード
│   ├── /app/scouts  # スカウト検索
│   ├── /app/scouts/new    # 新規スカウト登録
│   ├── /app/scouts/:id    # スカウト詳細
│   ├── /app/group   # グループ管理（未実装）
│   └── /app/setting # 設定（未実装）
└── /sysmanager/*    # システム管理
```

## 認証フロー

1. 未認証ユーザーが `/app/*` にアクセス → `/auth/login` にリダイレクト
2. 認証済みユーザーが `/auth/*` にアクセス → `/app` にリダイレクト
3. ランディングページ（`/`）は誰でもアクセス可能
4. メール未認証の場合は `/auth/verify` へ誘導

## 実装詳細

### ルーティング技術

- **ルーター**: React Router 7.7.1 を使用
- **認証管理**: AuthContext で状態管理
- **ネストルーティング**: App.tsx で基本振り分け、各領域で詳細ルーティング
- **プロテクション**: 認証状態に基づいた自動リダイレクト

### パフォーマンス最適化

- **遅延読み込み**: `lazy()` と `Suspense` によるコード分割
- **キャッシュ**: 検索クエリとスカウトデータのローカルキャッシュ
- **静的生成**: ランディングページの事前ビルド

### エラーハンドリング

- **404 処理**: 不正 URL に対する適切な案内画面
- **エラー境界**: `ErrorProvider` によるエラーキャッチ
- **リロード機能**: エラー時の復旧手段提供

## UI/UX 設計

### 共通レイアウト

- **認証領域**: 背景画像 + ブラーカード
- **アプリ領域**: ヘッダーナビゲーション + コンテンツエリア
- **レスポンシブ**: Bootstrap グリッドシステム活用

### ナビゲーション

- **ヘッダー**: アプリ内の主要機能へのリンク
- **パンくずリスト**: 現在位置の明示
- **戻るボタン**: 直感的なナビゲーション

### ロール別表示

- **リーダー**: 編集権限、管理機能へのアクセス
- **見学者**: 閲覧のみ、制限された機能
- **管理者**: システム管理機能へのアクセス

## 今後の拡張予定

### 短期実装予定

- グループ管理機能の完全実装
- 設定画面の追加
- 高度な検索・フィルタ機能

### 中長期実装予定

- PWA 対応（オフライン機能）
- プッシュ通知機能
- 詳細な分析・レポート機能
- API エンドポイントの提供

- **ルーター**: React Router 7.1.1 を使用
- **認証管理**: AuthContext で状態管理
- **ネストルーティング**: App.tsx で基本振り分け、各領域で詳細ルーティング
- **プロテクション**: 認証状態に基づいた自動リダイレクト
