# コード設計 - App 領域

`app` ディレクトリ以下では、認証済みユーザー向けのメインアプリケーション機能を実装する。

## 現在の実装状況

### ✅ 実装済み

#### app.tsx

メインアプリケーションのルートコンポーネント。

- **認証チェック**: 未ログイン時は `/auth/login` にリダイレクト
- **レイアウト**: ヘッダー + コンテンツエリアの基本構造
- **ルーティング**: React Router による画面遷移管理

#### parts/header.tsx

アプリケーション共通ヘッダーコンポーネント。

- **機能**:
  - ブランドロゴとアプリ名表示
  - メインナビゲーション（スカウト検索、グループ管理、設定）
  - ユーザー名表示
  - ログアウト機能
  - レスポンシブ対応（オフキャンバスメニュー）
  - 外部ヘルプページへのリンク

### ❌ 未実装領域

以下の機能は画面遷移の枠組みのみ存在し、実際の機能は未実装：

#### ダッシュボード (`/app/`)

**予定機能**:

- アプリの更新情報・お知らせ表示
- ユーザー情報の簡易表示
- メールアドレス未認証時の認証促進 UI
- 初期設定未完了（`inited: false`）時の設定案内 UI
- クイックアクセスボタン

#### スカウト検索・管理 (`/app/scouts`)

**予定機能**:

- スカウト一覧表示
- 検索・フィルタリング機能
- 個別スカウト詳細情報
- 進級記録の閲覧・編集
- 技能章進捗管理

#### グループ管理 (`/app/group`)

**予定機能**:

- 所属団体のメンバー一覧
- 権限管理（管理者のみ）
- グループ設定
- メンバーの追加・削除

#### 設定画面 (`/app/setting`)

**予定機能**:

- ユーザープロフィール編集
- パスワード変更
- 通知設定
- アカウント削除

## 設計方針

### アーキテクチャパターン

- **認証ガード**: 全ての App 領域は認証必須
- **権限ベースアクセス**: ユーザーの所属・権限に応じた機能制限
- **データドリブン**: Firestore からのリアルタイムデータ表示

### UI/UX 方針

- **Bootstrap 5**: 統一された UI コンポーネント
- **レスポンシブデザイン**: モバイルファーストのアプローチ
- **直感的ナビゲーション**: 分かりやすい情報アーキテクチャ
- **高速レスポンス**: ローディング状態の適切な表示

### 状態管理

- **AuthContext**: 認証状態とユーザー基本情報
- **個別データ**: 各画面で必要なデータのオンデマンド取得
- **キャッシュ戦略**: Firebase の自動キャッシュ機能活用

## 実装予定の構造

```
app/
├── app.tsx                 # ✅ メインルーティング
├── parts/
│   └── header.tsx          # ✅ 共通ヘッダー
├── dashboard/              # ❌ ダッシュボード
│   └── dashboard.tsx
├── scouts/                 # ❌ スカウト管理
│   ├── scoutsList.tsx      # スカウト一覧
│   ├── scoutDetail.tsx     # スカウト詳細
│   └── scoutEdit.tsx       # スカウト編集
├── group/                  # ❌ グループ管理
│   ├── groupOverview.tsx   # グループ概要
│   ├── memberList.tsx      # メンバー一覧
│   └── groupSettings.tsx   # グループ設定
└── settings/               # ❌ 設定
    ├── profile.tsx         # プロフィール設定
    ├── account.tsx         # アカウント設定
    └── notifications.tsx   # 通知設定
```

## Firebase 連携

### 必要なデータベース操作

- **スカウトデータ**: 所属団体のスカウト情報取得・更新
- **ユーザー権限**: グループ内での権限確認
- **リアルタイム更新**: 複数ユーザーでの同時編集対応

### セキュリティルール連携

- **閲覧権限**: ユーザーの `knowScouts` 配列による制限
- **編集権限**: 権限レベルに応じた操作制限
- **団体内制限**: 異なる団体のデータは非表示

## エラーハンドリング

- **ネットワークエラー**: オフライン対応とリトライ機能
- **権限エラー**: 適切な権限不足メッセージの表示
- **データエラー**: 破損データの適切な処理

## パフォーマンス考慮

- **遅延ローディング**: 大量データの段階的読み込み
- **仮想化**: 長いリストの効率的な表示
- **キャッシュ活用**: 頻繁にアクセスするデータの最適化
